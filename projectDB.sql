CREATE DATABASE cs4347project;

USE cs4347project;
#DROP TABLE ADMIN_PROFILE, ADVERTISER_LISTINGS, ADVERTISER_POST, ADVERTISER_PROFILE, CATEGORIES, CATEGORIZED, FORUM_POST, FREE_ITEMS, GENERAL_PROFILE, LISTINGS, LOOKING_FOR_ITEM, PROFILE, RAFFLE_ITEMS, SELL_ITEMS, TRANSACTIONS, USER_LISTINGS, USER_POST;
DROP TABLE GENERAL_PROFILE;

CREATE TABLE PROFILE(
	NetID VARCHAR(100) NOT NULL,
    Verification_Status BOOLEAN,
    Email VARCHAR(1000) NOT NULL,
    Buy_Rating INT,
    Sell_Rating INT,
    PRIMARY KEY(NetID)
);

CREATE TABLE GENERAL_PROFILE(
	NetID VARCHAR(100) NOT NULL,
	ProfileID INT NOT NULL,
	Transaction_History VARCHAR(45) NULL,
	PRIMARY KEY (`NetID`, `ProfileID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE ADMIN_PROFILE(
	NetID VARCHAR(100) NOT NULL,
	AdminID INT NOT NULL,
	PRIMARY KEY (`NetID`, `AdminID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE ADVERTISER_PROFILE(
	NetID VARCHAR(100) NOT NULL,
	AdvertiserID INT NOT NULL,
	PRIMARY KEY (`NetID`, `AdvertiserID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE TRANSACTIONS(
	TItemID INT NOT NULL,
    NetID VARCHAR(100) NOT NULL,
	SellerID INT NOT NULL,
    Price INT NOT NULL,
    CustomerID INT NOT NULL,
	PRIMARY KEY (`NetID`, `TItemID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
);

CREATE TABLE LISTINGS(
	ListingID INT NOT NULL,
    TItemID INT NOT NULL,
    NetID VARCHAR(100) NOT NULL,
    Date_Created DATE NOT NULL,
    DATE_Fulfilled DATE,
	Information VARCHAR(10000),
    PRIMARY KEY (`NetID`, `TItemID`, `ListingID`),
    CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `TItemID`
    FOREIGN KEY (TItemID) REFERENCES TRANSACTIONS(TItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE USER_LISTINGS(
	ListingID INT NOT NULL,
    NetID VARCHAR(100) NOT NULL,
    Price INT NOT NULL,
    PRIMARY KEY (`NetID`, `ListingID`),
    CONSTRAINT `ListingID`
    FOREIGN KEY (ListingID) REFERENCES LISTINGS(ListingID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE ADVERTISER_LISTINGS(
	ListingID INT NOT NULL,
    AdvertiserID VARCHAR(100) NOT NULL,
    Price INT,
    PRIMARY KEY (`AdvertiserID`, `ListingID`),
    CONSTRAINT `ListingID`
    FOREIGN KEY (ListingID) REFERENCES LISTINGS(ListingID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `AdvertiserID`
    FOREIGN KEY (AdvertiserID) REFERENCES ADVERTISER_PROFILE(AdvertiserID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE CATEGORIES(
	CItemID INT NOT NULL,
    Information VARCHAR(10000),
    Tech BOOLEAN,
    Furniture BOOLEAN,
    Food BOOLEAN,
    Picture BOOLEAN, 
    Sport_Item BOOLEAN,
    PRIMARY KEY (CItemID)
);

CREATE TABLE FORUM_POST(
	PostID INT NOT NULL,
    CItemID INT NOT NULL,
	NetID VARCHAR(100) NOT NULL,
    PRIMARY KEY (`PostID`, `CItemID`, `NetID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE USER_POST(
	PostID INT NOT NULL,
    UNetID VARCHAR(100) NOT NULL,
    PRIMARY KEY (`PostID`, `UNetID`),
    CONSTRAINT `UNetID`
    FOREIGN KEY (UNetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `PostID`
    FOREIGN KEY (PostID) REFERENCES FORUM_POST(PostID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE ADVERTISER_POST(
	PostID INT NOT NULL,
    AdvertiserID VARCHAR(100) NOT NULL,
    PRIMARY KEY (`PostID`, `AdvertiserID`),
    CONSTRAINT `AdvertiserID`
    FOREIGN KEY (AdvertiserID) REFERENCES ADVERISER_PROFILE(AdvertiserID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `PostID`
    FOREIGN KEY (PostID) REFERENCES FORUNM_POST(PostID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE SELL_ITEMS(
	CItemID INT NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE FREE_ITEMS(
	CItemID INT NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE LOOKING_FOR_ITEM(
	CItemID INT NOT NULL,
    Title VARCHAR(100) NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE RAFFLE_ITEMS(
	CItemID INT NOT NULL,
    Winner VARCHAR(1000) NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE ADVERTISEMENTS(
	AdvertiserID INT NOT NULL,
    Ad_Fee INT NOT NULL,
    APostID INT NOT NULL,
    PRIMARY KEY(`AdvertiserID`, `APostID`),
	CONSTRAINT `AdvertiserID`
    FOREIGN KEY (AdvertiserID) REFERENCES ADVERISER_PROFILE(AdvertiserID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE CATEGORIZED(
	ListingID INT NOT NULL,
    CItemID INT NOT NULL,
    PRIMARY KEY(`ListingID`, `CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `ListingID`
    FOREIGN KEY (ListingID) REFERENCES LISTINGS(ListingID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

INSERT INTO  PROFILE 
VALUES ('ABC123', TRUE, 'ABC123@utdallas.edu', 3, 2),
('XYZ456', FALSE, 'XYZ456@utdallas.edu', 1, 5),
('DEF789', TRUE, 'DEF789@utdallas.edu', 4, 3), 
('MNO321', FALSE, 'MNO321@utdallas.edu', 2, 1), 
('JKL654', TRUE, 'JKL654@utdallas.edu', 5, 4),
('QWE234', TRUE, 'QWE234@utdallas.edu', 2, 3),
('ASD567', FALSE, 'ASD567@utdallas.edu', 4, 1),
('ZXC890', TRUE, 'ZXC890@utdallas.edu', 1, 5),
('POI345', FALSE, 'POI345@utdallas.edu', 5, 2),
('LKJ678', TRUE, 'LKJ678@utdallas.edu', 3, 4),
('UIO901', TRUE, 'UIO901@utdallas.edu', 4, 2),
('YHN234', FALSE, 'YHN234@utdallas.edu', 2, 3),
('TGB567', TRUE, 'TGB567@utdallas.edu', 1, 4),
('RFV890', FALSE, 'RFV890@utdallas.edu', 3, 2),
('EDC123', TRUE, 'EDC123@utdallas.edu', 5, 1),
('WSX456', FALSE, 'WSX456@utdallas.edu', 4, 3),
('UJM789', TRUE, 'UJM789@utdallas.edu', 2, 5),
('IKL012', TRUE, 'IKL012@utdallas.edu', 3, 1),
('POL345', FALSE, 'POL345@utdallas.edu', 5, 4),
('MNY678', TRUE, 'MNY678@utdallas.edu', 1, 3),
('BGT901', FALSE, 'BGT901@utdallas.edu', 2, 5),
('VFR234', TRUE, 'VFR234@utdallas.edu', 4, 1),
('CDE567', FALSE, 'CDE567@utdallas.edu', 3, 5),
('XSW890', TRUE, 'XSW890@utdallas.edu', 2, 4),
('ZAQ123', TRUE, 'ZAQ123@utdallas.edu', 5, 1);

UPDATE PROFILE SET NetID = 'ABC124' WHERE NetID = 'ABC123'; # Update Statement

INSERT INTO GENERAL_PROFILE
VALUES ('ABC123', '1', 'No History'),
('XYZ456', '2', 'No History'),
('DEF789', '3', 'No History'), 
('MNO321', '4', 'No History'), 
('JKL654', '5', 'No History'),
('QWE234', '6', 'No History'),
('ASD567', '7', 'No History'),
('ZXC890', '8', 'No History'),
('POI345', '9', 'No History'),
('LKJ678', '10', 'No History'),
('UIO901', '11', 'No History'),
('YHN234', '12', 'No History'),
('TGB567', '13', 'No History'),
('RFV890', '14', 'No History'),
('EDC123', '15', 'No History'),
('WSX456', '16', 'No History'),
('UJM789', '17', 'No History'),
('IKL012', '18', 'No History'),
('POL345', '19', 'No History'),
('MNY678', '20', 'No History'),
('BGT901', '21', 'No History'),
('VFR234', '22', 'No History'),
('CDE567', '23', 'No History'),
('XSW890', '24', 'No History'),
('ZAQ123', '25', 'No History');

DELETE FROM GENERAL_PROFILE WHERE ProfileID = '21'; # Delete Statement
DELETE FROM GENERAL_PROFILE WHERE ProfileID = '22';
DELETE FROM GENERAL_PROFILE WHERE ProfileID = '23';
DELETE FROM GENERAL_PROFILE WHERE ProfileID = '24';
DELETE FROM GENERAL_PROFILE WHERE ProfileID = '25';

INSERT INTO ADMIN_PROFILE
VALUES ('BGT901', '21'),
('VFR234', '22'),
('CDE567', '23');

INSERT INTO ADVERTISER_PROFILE
VALUES ('XSW890', '24'),
('ZAQ123', '25');
