CREATE DATABASE cs4347project;
#DROP DATABASE cs4347project;
USE cs4347project;
#DROP TABLE ADMIN_PROFILE, ADVERTISEMENTS, ADVERTISER_LISTINGS, ADVERTISER_POST, ADVERTISER_PROFILE, CATEGORIES, CATEGORIZED, FORUM_POST, FREE_ITEMS, GENERAL_PROFILE, LISTINGS, LOOKING_FOR_ITEM, PROFILE, RAFFLE_ITEMS, SELL_ITEMS, TRANSACTIONS, USER_LISTINGS, USER_POST;
#DROP TABLE PROFILE;

CREATE TABLE PROFILE(
	NetID VARCHAR(100) NOT NULL,
    Verification_Status BOOLEAN,
    Email VARCHAR(1000) NOT NULL,
    Buy_Rating INT,
    Sell_Rating INT,
    PRIMARY KEY(NetID)
);

CREATE TABLE GENERAL_PROFILE(
	NetID VARCHAR(100) NOT NULL,
	ProfileID INT NOT NULL,
	Transaction_History VARCHAR(45) NULL,
	PRIMARY KEY (`NetID`, `ProfileID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE ADMIN_PROFILE(
	NetID VARCHAR(100) NOT NULL,
	AdminID INT NOT NULL,
	PRIMARY KEY (`NetID`, `AdminID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE ADVERTISER_PROFILE(
	NetID VARCHAR(100) NOT NULL,
	AdvertiserID INT NOT NULL,
	PRIMARY KEY (`NetID`, `AdvertiserID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
		ON UPDATE CASCADE
);

CREATE TABLE TRANSACTIONS(
	TItemID INT NOT NULL,
    NetID VARCHAR(100) NOT NULL,
	SellerID INT NOT NULL,
    Price FLOAT NOT NULL,
    CustomerID INT,
	PRIMARY KEY (`NetID`, `TItemID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE NO ACTION
		ON UPDATE NO ACTION
);

CREATE TABLE LISTINGS(
	ListingID INT NOT NULL,
    TItemID INT NOT NULL,
    GenericID VARCHAR(100) NOT NULL,
    Date_Created DATE NOT NULL,
    DATE_Fulfilled DATE,
	Information VARCHAR(10000),
    PRIMARY KEY (`GenericID`, `TItemID`, `ListingID`),
	CONSTRAINT `TItemID`
    FOREIGN KEY (TItemID) REFERENCES TRANSACTIONS(TItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE USER_LISTINGS(
	ListingID INT NOT NULL,
    ProfileID VARCHAR(100) NOT NULL,
    Price FLOAT NOT NULL,
    PRIMARY KEY (`ProfileID`, `ListingID`),
    CONSTRAINT `ListingID`
    FOREIGN KEY (ListingID) REFERENCES LISTINGS(ListingID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `ProfileID`
    FOREIGN KEY (ProfileID) REFERENCES GENERAL_PROFILE(ProfileID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE ADVERTISER_LISTINGS(
	ListingID INT NOT NULL,
    AdvertiserID VARCHAR(100) NOT NULL,
    Price FLOAT,
    PRIMARY KEY (`AdvertiserID`, `ListingID`),
    CONSTRAINT `ListingID`
    FOREIGN KEY (ListingID) REFERENCES LISTINGS(ListingID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `AdvertiserID`
    FOREIGN KEY (AdvertiserID) REFERENCES ADVERTISER_PROFILE(AdvertiserID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE CATEGORIES(
	CItemID INT NOT NULL,
    Information VARCHAR(10000),
    Tech BOOLEAN,
    Furniture BOOLEAN,
    Food BOOLEAN,
    Picture BOOLEAN, 
    Sport_Item BOOLEAN,
    PRIMARY KEY (CItemID)
);

CREATE TABLE FORUM_POST(
	PostID INT NOT NULL,
    CItemID INT NOT NULL,
	NetID VARCHAR(100) NOT NULL,
    PRIMARY KEY (`PostID`, `CItemID`, `NetID`),
	CONSTRAINT `NetID`
    FOREIGN KEY (NetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE USER_POST(
	PostID INT NOT NULL,
    UNetID VARCHAR(100) NOT NULL,
    PRIMARY KEY (`PostID`, `UNetID`),
    CONSTRAINT `UNetID`
    FOREIGN KEY (UNetID) REFERENCES PROFILE(NetID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `PostID`
    FOREIGN KEY (PostID) REFERENCES FORUM_POST(PostID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE ADVERTISER_POST(
	PostID INT NOT NULL,
    AdvertiserID VARCHAR(100) NOT NULL,
    PRIMARY KEY (`PostID`, `AdvertiserID`),
    CONSTRAINT `AdvertiserID`
    FOREIGN KEY (AdvertiserID) REFERENCES ADVERISER_PROFILE(AdvertiserID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `PostID`
    FOREIGN KEY (PostID) REFERENCES FORUNM_POST(PostID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE SELL_ITEMS(
	CItemID INT NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE FREE_ITEMS(
	CItemID INT NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE LOOKING_FOR_ITEM(
	CItemID INT NOT NULL,
    Title VARCHAR(100) NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE RAFFLE_ITEMS(
	CItemID INT NOT NULL,
    Winner VARCHAR(1000) NOT NULL,
    PRIMARY KEY(`CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE ADVERTISEMENTS(
	AdvertiserID INT NOT NULL,
    Ad_Fee INT NOT NULL,
    APostID INT NOT NULL,
    PRIMARY KEY(`AdvertiserID`, `APostID`),
	CONSTRAINT `AdvertiserID`
    FOREIGN KEY (AdvertiserID) REFERENCES ADVERISER_PROFILE(AdvertiserID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

CREATE TABLE CATEGORIZED(
	ListingID INT NOT NULL,
    CItemID INT NOT NULL,
    PRIMARY KEY(`ListingID`, `CItemID`),
    CONSTRAINT `CItemID`
    FOREIGN KEY (CItemID) REFERENCES CATEGORIES(CItemID)
		ON DELETE CASCADE
        ON UPDATE CASCADE,
	CONSTRAINT `ListingID`
    FOREIGN KEY (ListingID) REFERENCES LISTINGS(ListingID)
		ON DELETE CASCADE
        ON UPDATE CASCADE
);

INSERT INTO PROFILE 
VALUES ('ABC123', TRUE, 'ABC123@utdallas.edu', 3, 2),
('XYZ456', FALSE, 'XYZ456@utdallas.edu', 1, 5),
('DEF789', TRUE, 'DEF789@utdallas.edu', 4, 3), 
('MNO321', FALSE, 'MNO321@utdallas.edu', 2, 1), 
('JKL654', TRUE, 'JKL654@utdallas.edu', 5, 4),
('QWE234', TRUE, 'QWE234@utdallas.edu', 2, 3),
('ASD567', FALSE, 'ASD567@utdallas.edu', 4, 1),
('ZXC890', TRUE, 'ZXC890@utdallas.edu', 1, 5),
('POI345', FALSE, 'POI345@utdallas.edu', 5, 2),
('LKJ678', TRUE, 'LKJ678@utdallas.edu', 3, 4),
('UIO901', TRUE, 'UIO901@utdallas.edu', 4, 2),
('YHN234', FALSE, 'YHN234@utdallas.edu', 2, 3),
('TGB567', TRUE, 'TGB567@utdallas.edu', 1, 4),
('RFV890', FALSE, 'RFV890@utdallas.edu', 3, 2),
('EDC123', TRUE, 'EDC123@utdallas.edu', 5, 1),
('WSX456', FALSE, 'WSX456@utdallas.edu', 4, 3),
('UJM789', TRUE, 'UJM789@utdallas.edu', 2, 5),
('IKL012', TRUE, 'IKL012@utdallas.edu', 3, 1),
('POL345', FALSE, 'POL345@utdallas.edu', 5, 4),
('MNY678', TRUE, 'MNY678@utdallas.edu', 1, 3),
('BGT901', FALSE, 'BGT901@utdallas.edu', 2, 5),
('VFR234', TRUE, 'VFR234@utdallas.edu', 4, 1),
('CDE567', FALSE, 'CDE567@utdallas.edu', 3, 5),
('XSW890', TRUE, 'XSW890@utdallas.edu', 2, 4),
('ZAQ123', TRUE, 'ZAQ123@utdallas.edu', 5, 1);

#UPDATE PROFILE SET NetID = 'ABC124' WHERE NetID = 'ABC123'; # Update Statement

INSERT INTO GENERAL_PROFILE
VALUES ('ABC123', '1', 'No History'),
('XYZ456', '2', 'No History'),
('DEF789', '3', 'No History'), 
('MNO321', '4', 'No History'), 
('JKL654', '5', 'No History'),
('QWE234', '6', 'No History'),
('ASD567', '7', 'No History'),
('ZXC890', '8', 'No History'),
('POI345', '9', 'No History'),
('LKJ678', '10', 'No History'),
('UIO901', '11', 'No History'),
('YHN234', '12', 'No History'),
('TGB567', '13', 'No History'),
('RFV890', '14', 'No History'),
('EDC123', '15', 'No History'),
('WSX456', '16', 'No History'),
('UJM789', '17', 'No History'),
('IKL012', '18', 'No History'),
('POL345', '19', 'No History'),
('MNY678', '20', 'No History'),
('BGT901', '21', 'No History'),
('VFR234', '22', 'No History'),
('CDE567', '23', 'No History'),
('XSW890', '24', 'No History'),
('ZAQ123', '25', 'No History');

#DELETE FROM GENERAL_PROFILE WHERE ProfileID = '21'; # Delete Statement
#DELETE FROM GENERAL_PROFILE WHERE ProfileID = '22';
#DELETE FROM GENERAL_PROFILE WHERE ProfileID = '23';
#DELETE FROM GENERAL_PROFILE WHERE ProfileID = '24';
#DELETE FROM GENERAL_PROFILE WHERE ProfileID = '25';

INSERT INTO ADMIN_PROFILE
VALUES ('BGT901', '21'),
('VFR234', '22'),
('CDE567', '23');

INSERT INTO ADVERTISER_PROFILE
VALUES ('XSW890', '24'),
('ZAQ123', '25');

INSERT INTO TRANSACTIONS
VALUES (1234, 'ABC123', 5, 10.50, 6),
(5678, 'XYZ456', 17, 25.75, 8),
(9876, 'DEF789', 12, 15.25, 2),
(5432, 'MNO321', 3, 30.00, 14),
(8765, 'JKL654', 8, 20.50, 19),
(4321, 'ABC123', 10, 18.75, 7),
(2468, 'QWE234', 1, 12.25, 11),
(1357, 'ASD567', 14, 22.00, 4),
(8642, 'ZXC890', 9, 27.50, 5),
(9753, 'POI345', 6, 35.25, 12),
(7593, 'LKJ678', 2, 16.75, 16),
(5824, 'UIO901', 15, 14.50, 1),
(6948, 'YHN234', 18, 19.25, 10),
(8219, 'TGB567', 4, 21.00, 3),
(7382, 'RFV890', 20, 28.75, 15),
(1972, 'EDC123', 11, 32.50, 18),
(8712, 'WSX456', 7, 40.25, 9),
(3658, 'UJM789', 16, 24.00, 17),
(5826, 'IKL012', 13, 26.78, 11),
(5827, 'POL345', 13, 26.5, 16),
(5828, 'MNY678', 13, 26.65, 20);

INSERT INTO LISTINGS
VALUES (0001, 1234, 1, '2024-04-01', '2024-04-03', 'Product A is in excellent condition.'),
(0010, 5678, 2, '2024-04-02', '2024-04-04', 'Product B is brand new.'),
(0011, 9876, 3, '2024-04-03', '2024-04-05', 'Product C is slightly used.'),
(0100, 5432, 4, '2024-04-04', '2024-04-06', 'Product D is in good condition.'),
(0101, 8765, 5, '2024-04-05', NULL, 'Product E is on sale!'),
(0111, 4321, 6, '2024-04-06', NULL, 'Product F is discounted.'),
(1000, 2468, 7, '2024-04-07', NULL, 'Product G is available.'),
(1001, 1357, 8, '2024-04-08', NULL, 'Product H is ready to ship.'),
(1011, 8642, 9, '2024-04-09', NULL, 'Product I is on clearance.'),
(1111, 9753, 10, '2024-04-10', NULL, 'Product J is available.'),
(0000, 7593, 24, '2024-04-11', NULL, NULL),
(0001, 5824, 25, '2024-04-11', NULL, NULL);

INSERT INTO USER_LISTINGS
VALUES (0001, 1, 11.99),
(0010, 2, 10.99),
(0011, 3, 9.99),
(0100, 4, 8.99),
(0101, 5, 7.99),
(0111, 6, 6.99),
(1000, 7, 5.99),
(1001, 8, 4.99),
(1011, 9, 3.99),
(1111, 10, 2.99);

INSERT INTO ADVERTISER_LISTINGS
VALUES (0000, 24, 11.99),
(0001, 25, 12.99);

INSERT INTO CATEGORIES
VALUES (0001, 'Tech', TRUE, FALSE, FALSE, FALSE, FALSE),
(0002, 'Furniture', FALSE, TRUE, FALSE, FALSE, FALSE),
(0003, 'Food', FALSE, FALSE, TRUE, FALSE, FALSE),
(0004, 'Picture', FALSE, FALSE, FALSE, TRUE, FALSE),
(0005, 'Sports', FALSE, FALSE, FALSE, FALSE, TRUE);

INSERT INTO FORUM_POST
VALUES (421, 0004, 'XSW890'),
(153, 0005, 'QWE234'),
(621, 0002, 'POL345'),
(451, 0003, 'ZAQ123'),
(727, 0002, 'MNY678'),
(629, 0001, 'ZAQ123');

INSERT INTO USER_POST
VALUES (621, 'POL345'),
(629, 'ZAQ123'),
(153, 'QWE234'),
(727, 'MNY678');

INSERT INTO ADVERTISER_POST
VALUES (421, 'XSW890'),
(451, 'ZAQ123');

INSERT INTO SELL_ITEMS
VALUES (0001),
(0004);

INSERT INTO FREE_ITEMS
VALUES (0003);

INSERT INTO LOOKING_FOR_ITEM
VALUES (0002, 'looking for a cheap wooden desk');

INSERT INTO RAFFLE_ITEMS
VALUES (0005, 'EDC123');

INSERT INTO ADVERTISEMENTS
VALUES ('XSW890', 1400, 310),
('ZAQ123', 800, 793);

INSERT INTO CATEGORIZED
VALUES (0001, 0003),
(0010, 0002),
(0011, 0004),
(0100, 0002),
(0101, 0004),
(0111, 0001),
(1000, 0001),
(1001, 0003),
(1011, 0005),
(1111, 0004),
(0000, 0001),
(0001, 0002);

SELECT COUNT(*) FROM PROFILE; # Query 1
SELECT AdminID FROM ADMIN_PROFILE; # Query 2
SELECT NetID FROM PROFILE NATURAL JOIN FORUM_POST; # Query 3
SELECT AVG(Price) FROM TRANSACTIONS WHERE Price > 0; # Query 4
SELECT * FROM LISTINGS WHERE DATE(Date_Fulfilled) >= '2024-04-01' AND DATE(Date_Created) <= '2024-04-01' ORDER BY Date_Created, TItemId; # Query 5